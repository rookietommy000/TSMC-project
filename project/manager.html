<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/manager.css">
  <link rel="stylesheet" href="css/all.min.css">
  <link rel="stylesheet" href="css/sweetalert2.min.css">
  <style>
    .body {
      background-color: #f0cece;
    }

    .stop {
      background-color: #ffcccc;
    }
  </style>
</head>

<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <button class="openbtn fw-900" onclick="openNav()">☰ 後臺管理系統</button>
      </div>
      <div class="col text-end">
        <span class="text-dark h3 mt-3" id="user_message"></span>
        <button type="button" id="loginoutButton" class="mt-3 btn btn-outline-danger">登出</button>
      </div>
    </div>
  </div>

  <div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
    <a href="#" onclick="openTab(event, 'Home')">首頁</a>
    <a href="#" onclick="openTab(event, 'member')"><i class="fa-solid fa-user"></i>&nbsp;會員管理</a>
    <a href="#" class="dropdown-toggle-split nav-link dropdown-toggle tab" data-bs-toggle="dropdown"
      aria-expanded="false">
      <i class="fa-brands fa-pagelines"></i>&nbsp;商品管理
    </a>
    <ul class="dropdown-menu">
      <li><a href="#" onclick="openTab(event, 'product')" class="text-dark">商品管理</a></li>
      <li><a href="#" onclick="openTab(event, 'product-type')" class="text-dark">類別總覽</a></li>
    </ul>
    <a href="#" onclick="openTab(event, 'news')"><i class="fa-solid fa-rss"></i>&nbsp;消息管理</a>
    <a href="#" onclick="openTab(event, 'cart')"><i class="fa-solid fa-chalkboard"></i>&nbsp;訂單管理</a>
    <a class="nav-link disabled" aria-disabled="true">待定</a>
  </div>

  <div id="main">
    <div class="tab-content" id="myTabContent">

      <!-- 後臺首頁 -->
      <div class="tab-pane fade show active" id="Home">
        <h2>首頁</h2>
      </div>

      <!-- 會員 -->
      <div class="tab-pane fade" id="member">
        <div class="container pt-5">
          <table class="table table-bordered table-hover table-sm border-success table-rwd">
            <caption class="text-end">會員列表</caption>
            <thead class="table-dark">
              <tr>
                <th>編號</th>
                <th>帳號</th>
                <th>Email</th>
                <th>停權</th>
                <th>註冊時間</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="mydata">
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#updateModal">更新</button>
                  <button class="btn btn-danger">刪除</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="container">
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center" id="pageList">
              <li class="page-item"><a class="page-link" href="#" onclick="drawTable(0)">1</a></li>
            </ul>
          </nav>
        </div>

        <!-- updateModal -->
        <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header text-bg-success">
                <h1 class="modal-title fs-3 fw-900" id="exampleModalLabel">會員更新</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="updateModal_username" class="form-label">帳號</label>
                  <input type="text" class="form-control" disabled id="updateModal_username"
                    name="updateModal_username">
                </div>
                <div class="mb-3">
                  <label for="updateModal_email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="updateModal_email" name="updateModal_email">
                </div>
                <div class="mb-3">
                  <label for="updateModal_state" class="form-label">狀態</label>
                  <input type="number" class="form-control" min="0" max="1" id="updateModal_state"
                    oninput="checkStateInput(this)" name="updateModal_state">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="updateModal_updata_btn">確認</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 商品總覽 -->
      <div class="tab-pane fade" id="product">
        <div class="container">
          <div class="text-end">
            <button class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#addModal">新增</button>
          </div>
          <table class="table table-bordered table-hover table-sm border-success table-rwd">
            <caption class="text-end">消息列表</caption>
            <thead class="table-dark">
              <tr>
                <th class="text-center">編號</th>
                <th class="text-center">商品名稱</th>
                <th class="text-center">圖片</th>
                <th class="text-center">類別</th>
                <th class="text-center">標題</th>
                <th class="text-center">描述</th>
                <th class="text-center">價錢</th>
                <th class="text-center">建立時間</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="product01">
              <tr>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="py-4"></td>
                <td class="text-center py-4">
                  <div class="d-flex align-content-center justify-content-center">
                    <button class="btn btn-success me-2" data-bs-toggle="modal"
                      data-bs-target="#updatenewsModal">更新</button>
                    <button class="btn btn-danger">刪除</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 新增商品 -->
        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">新增商品</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addProductForm">
                  <div class="mb-3">
                    <label for="pname" class="form-label">商品名稱</label>
                    <input type="text" class="form-control" id="pname" name="pname" placeholder="輸入商品名稱">
                  </div>
                  <div class="mb-3">
                    <label for="pprice" class="form-label">價格(NT)</label>
                    <input type="number" class="form-control" id="pprice" name="pprice" min="0" max="100" value="50">
                  </div>
                  <div class="mb-3">
                    <label for="category" class="form-label">類別</label>
                    <select name="category" id="category" class="form-select">
                      <option selected disabled>--- 選擇類別 ---</option>
                      <option value="植栽">植栽</option>
                      <option value="種子">種子</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label for="num01" class="form-label">數量</label>
                    <input type="number" name="num01" id="num01" class="form-control" min="1" max="30">
                  </div>
                  <div class="mb-3">
                    <label for="pimage" class="form-label">圖片</label>
                    <input type="file" class="form-control" id="pimage" name="pimage">
                  </div>
                  <div class="mb-3">
                    <label for="content" class="form-label">商品描述</label>
                    <textarea class="form-control" id="content" name="content" rows="3"></textarea>
                  </div>

                  <div class="my-3">
                    <h4 class="mb-2">額外加購</h4>
                    <div class="form-check form-check-inline">
                      <input type="checkbox" class="form-check-input" id="chk01" name="chk" value="堆肥">
                      <label for="chk01" class="form-check-label">堆肥</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input type="checkbox" class="form-check-input" id="chk02" name="chk" value="花盆">
                      <label for="chk02" class="form-check-label">花盆</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input type="checkbox" class="form-check-input" id="chk03" name="chk" value="噴壺">
                      <label for="chk03" class="form-check-label">噴壺</label>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmAddButton">確認新增</button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- 類別管理 -->
      <div class="tab-pane fade" id="product-type">
        <!-- <div class="content-wrapper"> -->
        <div class="container">
          <div class="row d-flex justify-content-center mt-3 mx-3">
            <div class="text-end">
              <button class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#addtypeModal">新增</button>
            </div>
            <table class="table table-bordered mb-3 text-center">
              <thead>
                <tr>
                  <th width="10%">項次</th>
                  <!-- <th style="width: 10%;">ID</th> -->
                  <th>名稱</th>
                  <th width="15%">功能</th>
                </tr>
              </thead>
              <tbody id="mytype">
              </tbody>
            </table>
          </div>
        </div>
        <!-- </div> -->

        <!-- Modal: 新增 -->
        <div class="modal fade" id="addtypeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header text-bg-info">
                <h1 class="modal-title fs-5 fw-900" id="exampleModalLabel">新增商品分類</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="tname" class="form-label">名稱</label>
                  <input type="text" class="form-control" name="tname" id="tname">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="oktype_button">確認</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal: 修改 -->
        <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <input type="hidden" id="updateModalID">
            <div class="modal-content">
              <div class="modal-header text-bg-info">
                <h1 class="modal-title fs-5 fw-900" id="exampleModalLabel">修改商品分類</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="updateModalName" class="form-label">名稱</label>
                  <input type="text" class="form-control" name="updateModalName" id="updateModalName">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="modal_updatetype_btn">確認</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 消息管理 -->
      <div class="tab-pane fade" id="news">
        <div class="container">
          <div class="text-end">
            <button class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#addNewsModal">新增</button>
          </div>
          <table class="table table-bordered table-hover table-sm border-success table-rwd">
            <caption class="text-end">消息列表</caption>
            <thead class="table-dark">
              <tr>
                <th class="text-center">編號</th>
                <th class="text-center">大標</th>
                <th class="text-center">標題</th>
                <th class="text-center">文章</th>
                <th class="text-center">建立時間</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="mynews">
              <tr>
                <td class="py-4">1</td>
                <td class="py-4"></td>
                <td class="py-4">
                </td>
                <td class="py-4">
                </td>
                <td class="text-center py-4">
                  <div class="d-flex align-content-center justify-content-center">
                    <button class="btn btn-success me-2" data-bs-toggle="modal"
                      data-bs-target="#updatenewsModal">更新</button>
                    <button class="btn btn-danger">刪除</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Addmodal -->
        <div class="modal fade" id="addNewsModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">新增消息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="mb-3 form-floating">
                <input type="text" class="form-control" placeholder="" id="number" name="number" readonly>
                <label for="number">編號</label>
              </div>
              <div class="modal-body">
                <div class="mb-3 form-floating">
                  <input type="text" class="form-control" placeholder="" id="name" name="name">
                  <label for="name">大標</label>
                  <div class="valid-feedback">字數符合規定</div>
                  <div class="invalid-feedback">字數不符合規定</div>
                </div>
                <div class="mb-3 form-floating">
                  <input type="text" class="form-control" placeholder="" id="heading" name="heading">
                  <label for="heading">標題</label>
                  <div class="valid-feedback">數字正確(1~100)</div>
                  <div class="invalid-feedback">數字不正確</div>
                </div>
                <div class="mb-3">
                  <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="content"
                      style="height: 100px"></textarea>
                    <label for="content">文章</label>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-info" id="ok_button">確認</button>
              </div>
            </div>
          </div>
        </div>

        <!-- UPdatenewsModal -->
        <div class="modal fade" id="updatenewsModal" tabindex="-1" aria-labelledby="updateModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="updateModalLabel">更新消息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="updateId" class="form-label">編號</label>
                  <input type="text" class="form-control" id="updateId" name="updateId" readonly>
                </div>
                <div class="mb-3 form-floating">
                  <input type="text" class="form-control" placeholder="" id="updateTitle" name="updateTitle"
                    list="myoption">
                  <label for="updateTitle">Title</label>
                  <div class="valid-feedback">字數符合規定</div>
                  <div class="invalid-feedback">字數不符合規定</div>
                </div>
                <div class="mb-3">
                  <label for="updateHeading" class="form-label">Heading</label>
                  <input type="number" class="form-control" id="updateHeading" name="updateHeading">
                  <div class="valid-feedback">數字正確(1~100)</div>
                  <div class="invalid-feedback">數字不正確</div>
                </div>
                <div class="mb-3">
                  <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="updateContent"
                      style="height: 100px"></textarea>
                    <label for="updateContent">Content</label>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-info" id="updatenews_button">更新</button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- 訂單管理 -->
      <div class="tab-pane fade" id="cart">
        <h2>Contact Content</h2>
        <p>This is the contact tab content.</p>
      </div>
    </div>
  </div>



  <script src="js/jquery-3.7.1.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/manager.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/sweetalert2.all.min.js"></script>
  <script src="js/admin/login.js"></script>

  <!-- product商品資料新增 -->
  <!-- member會員資料引入 -->
  <script>
    // 限定輸入0或1
    function checkStateInput(input) {
      if (input.value !== '0' && input.value !== '1') {
        input.value = '';
        Swal.fire({
          title: "輸入錯誤",
          text: "請輸入 0 或 1",
          icon: "error",
          showClass: {
            popup: `
                  animate__animated
                  animate__fadeInUp
                  animate__faster
                `
          },
          hideClass: {
            popup: `
                  animate__animated
                  animate__fadeOutDown
                  animate__faster
                `
          }
        });
      }
    }

    var u_id; //for update
    var newData = [];
    $(function () {
      //讀取會員資料
      $.ajax({
        type: "GET",
        url: "api/manager-control/member_read-api.php",
        async: false,
        dataType: "json",
        success: showdata,
        error: function () {
          alert("error-member-Read-api.php");
        }
      });

      //#update_btn 更新按鈕監聽
      // $("#mydata #update_btn").click(function () {
      $("body").on("click", "#mydata #update_btn", function () {
        console.log($(this).data("id") + $(this).data("email") + $(this).data("username") + $(this).data("state"));
        u_id = $(this).data("id");
        $("#updateModal_username").val($(this).data("username"));
        $("#updateModal_email").val($(this).data("email"));
        $("#updateModal_state").val($(this).data("state"));
      });



      //delete_btn 刪除按鈕監聽
      // $("#mydata #delete_btn").click(function () {
      $("body").on("click", "#mydata #delete_btn", function () {
        Swal.fire({
          title: "確定要刪除?",
          text: "刪除後無法復原!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "確定!",
          cancelButtonText: "取消",
        }).then((result) => {
          if (result.isConfirmed) {
            console.log($(this).data("id"));
            // 傳遞刪除資料至後端api {"ID":"XX"}
            var dataJSON = {};
            dataJSON["ID"] = $(this).data("id");
            console.log(JSON.stringify(dataJSON));

            $.ajax({
              type: "POST",
              url: "api/manager-control/member_delete-api.php",
              data: JSON.stringify(dataJSON),
              dataType: "json",
              success: showdata_delete,
              error: function () {
                alert("error-member_delete-api.php");
              }
            });
          }
        });
      });


      //#updateModal_updata_btn 監聽
      $("#updateModal_updata_btn").click(function () {
        //傳遞更新資料至後端api {"ID":"XX", "Email":"XXXXX"}
        var dataJSON = {};
        dataJSON["ID"] = u_id;
        dataJSON["Email"] = $("#updateModal_email").val();
        dataJSON["State"] = $("#updateModal_state").val();
        console.log(JSON.stringify(dataJSON));

        $.ajax({
          type: "POST",
          url: "api/manager-control/member_update_api.php",
          data: JSON.stringify(dataJSON),
          dataType: "json",
          success: showdata_update,
          error: function () {
            alert("error-member-Update_api.php");
          }
        });
      });
    });
    function showdata(data) {
      //整理資料儲存為二維陣列
      data.data.forEach(function (item, key) {
        console.log(key);
        if (key % 6 == 0) {
          newData.push([]);
        }
        var page = parseInt(key / 6);
        newData[page].push(item);

      });
      drawTable(0);
      console.log(newData);

      //產生頁碼
      $("#pageList").empty();
      newData.forEach(function (item, key) {
        var thisPage = key + 1;
        var strHTML = '<li class="page-item"><a class="page-link" href="#" onclick="drawTable(' + key + ')">' + thisPage + '</a></li>';
        $("#pageList").append(strHTML);
      });
    }

    function drawTable(page) {
      $("#mydata").empty();
      newData[page].forEach(function (item) {
        var stateText;
        var stateClass;
        switch (item.State) {
          case '0':
            stateText = '停權';
            stateClass = 'stop';
            break;
          case '1':
            stateText = '正常';
            break;
          default:
            stateText = '未知狀態';
            break;
        }

        var strHTML = '<tr><td>' + item.ID + '</td><td>' +
          item.Username + '</td><td>' +
          item.Email + '</td><td>' +
          stateText + '</td><td>' +
          item.Creat_time + '</td><td><button class="btn btn-success me-2" data-id="' +
          item.ID + '" data-email="' +
          item.Email + '"  data-state="' +
          item.State + '" data-username="' +
          item.Username + '" id="update_btn"  data-bs-toggle="modal" data-bs-target="#updateModal">更新</button><button class="btn btn-danger" id="delete_btn" data-id="' + item.ID + '">刪除</button></td></tr>';

        $("#mydata").append(strHTML);
      });
    }


    function showdata_update(data) {
      console.log(data);
      if (data.state) {
        Swal.fire({
          position: "center",
          icon: "success",
          title: "成功儲存！",
          showConfirmButton: false,
          timer: 1500
        }).then(() => {
          // 關閉模態對話框
          $("#updateModal").modal("hide");
          location.replace(login.html);
        });
      } else {
        alert(data.message);
      }
    }


    function showdata_delete(data) {
      console.log(data);
      if (data.state) {
        alert(data.message);
        location.reload();
      } else {
        alert(data.message);
      }
    }
  </script>

  <!-- 消息管理 -->
  <script>
    // read
    $(function () {
      $.ajax({
        type: "GET",
        url: "api/news/news-read-api.php",
        dataType: "json",
        success: shownewsdata,
        error: function () {
          alert("error-api/news/news-read-api.php");
        }
      });
    });

    function shownewsdata(data) {
      console.log(data);

      var strHTMLnews = '';
      $("#mynews").empty();
      data.data.forEach(function (item) {
        console.log(item.ID);
        strHTMLnews += '<tr><td class="py-4">'
          + item.ID + '</td><td class="py-4">'
          + item.Title + '</td><td class="py-4">'
          + item.Heading + '</td><td class="py-4">'
          + item.content +
          '</td><td class="text-center py-4">'
          + item.Created_at +
          '</td><td class="text-center py-4"><div class="d-flex align-content-center justify-content-center"><button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#updatanews">更新</button><button class="btn btn-danger">刪除</button></div></td></tr>';
      });
      $("#mynews").append(strHTMLnews);

    }

    // create
    var flag_name = false;
    var flag_heading = false;
    var flag_content = false;

    // 監聽_及時監聽 #name
    $(function () {
      $("#name").bind("input propertychange", function () {
        console.log($(this).val().length);
        if ($(this).val().length > 0 && $(this).val().length < 10) {
          // 字數符合
          $(this).removeClass("is-invalid");
          $(this).addClass("is-valid");
          flag_name = true;
        } else {
          // 字數不符合
          $(this).removeClass("is-valid");
          $(this).addClass("is-invalid");
          flag_name = false;
        }
      });

      $("#heading").bind("input propertychange", function () {
        console.log($(this).val().length);
        if ($(this).val().length > 0 && $(this).val().length < 10) {
          // 字數符合
          $(this).removeClass("is-invalid");
          $(this).addClass("is-valid");
          flag_heading = true;
        } else {
          // 字數不符合
          $(this).removeClass("is-valid");
          $(this).addClass("is-invalid");
          flag_heading = false;
        }
      });

      $("#content").bind("input propertychange", function () {
        console.log($(this).val().length);
        if ($(this).val().length > 50 && $(this).val().length < 1000) {
          // 字數符合
          $(this).removeClass("is-invalid");
          $(this).addClass("is-valid");
          flag_content = true;
        } else {
          // 字數不符合
          $(this).removeClass("is-valid");
          $(this).addClass("is-invalid");
          flag_content = false;
        }
      });

      // 按鈕監聽
      $("#ok_button").click(function () {
        if (flag_name && flag_heading && flag_content) {
          console.log($("#name").val());

          var dataJSON = {};
          dataJSON["Title"] = $("#name").val();
          dataJSON["Heading"] = $("#heading").val();
          dataJSON["content"] = $("#content").val();
          console.log(JSON.stringify(dataJSON));
          //傳遞至後端
          $.ajax({
            type: "POST",
            url: "api/news/news-create-api.php",
            data: JSON.stringify(dataJSON),
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: showdatanews02,
            error: function (xhr, status, error) {
              console.log(xhr.responseText);
              alert("error-api/news/news-create-api.php");
            }
          });
        } else {
          alert("欄位有誤, 請修正!");
        }
      });
    });

    function showdatanews02(data) {
      console.log(data);
    }

     // 監聽#updata_btn
     $("#mytype #updatanews").click(function () {
      console.log("updata_btn_ok");
      console.log($(this).data("id"));

      u_id = $(this).data("id");
      $("#name").val($(this).data("name"));
    });

    // 監聽 #modal_update_btn
    $("#modal_updatetype_btn").click(function () {
      var dataJSON = {};
      dataJSON["ID"] = u_id;
      dataJSON["Name"] = $("#name").val();
      console.log(JSON.stringify(dataJSON));

      // 傳遞更新參數至後端api
      $.ajax({
        type: "POST",
        url: "api/news/news-update-api.php",
        data: JSON.stringify(dataJSON),
        dataType: "json",
        success: showdatatype_update,
        error: function () {
          alert("error-api/product-type/product-type_update-api.php");
        }
      });
    });

    function showdatatype_update(data) {
      console.log(data);
      if (data.state) {
        alert(data.message);
        location.href = "manager.html"
      } else {
        alert(data.message);
      }
    }


    //監聽#delete_btn
    $("#mytype #deletetype_btn").click(function () {
      if (confirm("確認刪除此筆資料嗎?")) {
        console.log($(this).data("id"));

        //產生json格式的參數
        var dataJSON = {};
        dataJSON["ID"] = $(this).data("id");
        console.log(JSON.stringify(dataJSON));

        //傳遞參數至後端api執行刪除功能
        $.ajax({
          type: "POST",
          url: "api/product-type/product-type_delete-api.php",
          data: JSON.stringify(dataJSON),
          dataType: "json",
          success: showdatatype_delete,
          error: function () {
            alert("error-api/product-type/product-type_delete-api.php");
          }
        });
      }
    });


    function showdatatype_delete(data) {
      console.log(data);
      if (data.state) {
        alert(data.message);
        location.href = "manager.html";
      } else {
        alert(data.message);
      }
    }
  </script>

  <!-- 類別 -->
  <script>
    // read
    $(function () {
      $.ajax({
        type: "GET",
        url: "api/product-type/product-type_read-api.php",
        dataType: "json",
        success: showtypedata,
        error: function () {
          alert("error-api/product-type/product-type_read-api.php");
        }
      });
    });

    function showtypedata(data) {
      console.log(data);

      var strHTMLtype = '';
      $("#mytype").empty();
      if (Array.isArray(data.data)) {
    data.data.forEach(function (item) {
        console.log(item.ID);
        strHTMLtype += '<tr><td class="py-4">'
          + item.ID + '</td><td class="py-4">'
          + item.Name + '</td><td class="text-center py-4">'
          + item.Created_at + '</td><td class="text-center py-4"><div class="d-flex align-content-center justify-content-center"><button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#updatetypeModal">更新</button><button class="btn btn-danger">刪除</button></div></td></tr>';
      });
      $("#mytype").append(strHTMLtype);

    }
  }

    // create
    var flag_name = false;

    // 監聽_及時監聽 #name
    $(function () {
      $("#tname").bind("input propertychange", function () {
        console.log($(this).val().length);
        if ($(this).val().length > 0 && $(this).val().length < 10) {
          // 字數符合
          $(this).removeClass("is-invalid");
          $(this).addClass("is-valid");
          flag_name = true;
        } else {
          // 字數不符合
          $(this).removeClass("is-valid");
          $(this).addClass("is-invalid");
          flag_name = false;
        }
      });

      // 按鈕監聽
      $("#oktype_button").click(function () {
        if (flag_name) {
          console.log($("#tname").val());

          var dataJSON = {};
          dataJSON["Name"] = $("#tname").val();
          console.log(JSON.stringify(dataJSON));
          //傳遞至後端
          $.ajax({
            type: "POST",
            url: "api/product-type/product-type_create-api.php",
            data: JSON.stringify(dataJSON),
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: showdatatype,
            error: function (xhr, status, error) {
              console.log(xhr.responseText);
              alert("error-api/product-type/product-type_create-api.php");
            }
          });
        } else {
          alert("欄位有誤, 請修正!");
        }
      });
    });

    function showdatatype(data) {
      console.log(data);
    }
    // 監聽#updata_btn
    $("#mytype #updatetypeModal").click(function () {
      console.log("updata_btn_ok");
      console.log($(this).data("id"));

      u_id = $(this).data("id");
      $("#tname").val($(this).data("tname"));
    });

    // 監聽 #modal_update_btn
    $("#modal_updatetype_btn").click(function () {
      var dataJSON = {};
      dataJSON["ID"] = u_id;
      dataJSON["Name"] = $("#tname").val();
      console.log(JSON.stringify(dataJSON));

      // 傳遞更新參數至後端api
      $.ajax({
        type: "POST",
        url: "api/product-type/product-type_update-api.php",
        data: JSON.stringify(dataJSON),
        dataType: "json",
        success: showdatatype_update,
        error: function () {
          alert("error-api/product-type/product-type_update-api.php");
        }
      });
    });

    function showdatatype_update(data) {
      console.log(data);
      if (data.state) {
        alert(data.message);
        location.href = "manager.html"
      } else {
        alert(data.message);
      }
    }


    //監聽#delete_btn
    $("#mytype #deletetype_btn").click(function () {
      if (confirm("確認刪除此筆資料嗎?")) {
        console.log($(this).data("id"));

        //產生json格式的參數
        var dataJSON = {};
        dataJSON["ID"] = $(this).data("id");
        console.log(JSON.stringify(dataJSON));

        //傳遞參數至後端api執行刪除功能
        $.ajax({
          type: "POST",
          url: "api/product-type/product-type_delete-api.php",
          data: JSON.stringify(dataJSON),
          dataType: "json",
          success: showdatatype_delete,
          error: function () {
            alert("error-api/product-type/product-type_delete-api.php");
          }
        });
      }
    });


    function showdatatype_delete(data) {
      console.log(data);
      if (data.state) {
        alert(data.message);
        location.href = "manager.html";
      } else {
        alert(data.message);
      }
    }

  </script>


</body>

</html>